# 远程GPU OCR部署说明

## 📋 概述

本方案允许你在本地CPU电脑上运行主程序，而将OCR识别任务分发到192.168.3.133这台有GPU的电脑上执行，从而大幅提升OCR处理速度。

## 🏗️ 架构说明

```
本地电脑 (CPU)                   远程电脑 (GPU)
┌─────────────────┐              ┌─────────────────┐
│   主程序GUI     │              │  OCR API服务    │
│                 │              │                 │
│  ┌───────────┐  │   HTTP请求   │  ┌───────────┐  │
│  │远程OCR客户端│◄─────────────►│  │GPU OCR引擎│  │
│  └───────────┘  │              │  └───────────┘  │
│                 │              │                 │
│  ┌───────────┐  │              │  ┌───────────┐  │
│  │本地OCR引擎│  │              │  │PaddleOCR  │  │
│  └───────────┘  │              │  │YOLO模型   │  │
└─────────────────┘              └─────────────────┘
```

## 🚀 部署步骤

### 第一步：在192.168.3.133上部署OCR服务器

1. **复制文件到远程电脑**
   ```bash
   # 将以下文件复制到192.168.3.133
   - remote_ocr_server.py
   - remote_ocr_requirements.txt
   - start_remote_ocr_server.bat
   - src/ 目录（整个src文件夹）
   ```

2. **安装依赖**
   ```bash
   pip install -r remote_ocr_requirements.txt
   ```

3. **启动OCR服务器**
   ```bash
   # Windows
   start_remote_ocr_server.bat
   
   # 或者直接运行
   python remote_ocr_server.py
   ```

4. **验证服务启动**
   - 访问 http://192.168.3.133:8888
   - 应该看到服务状态信息

### 第二步：在本地电脑上配置客户端

1. **启用远程OCR**
   ```bash
   python enable_remote_ocr.py
   # 选择 "1. 启用远程OCR"
   ```

2. **测试连接**
   ```bash
   python enable_remote_ocr.py
   # 选择 "3. 测试远程连接"
   ```

3. **启动主程序**
   ```bash
   python run_main.py
   ```

## ⚙️ 配置说明

### 远程OCR配置 (src/pdf_ocr_module/config.py)

```python
REMOTE_OCR_CONFIG = {
    "enabled": True,  # 是否启用远程OCR
    "server_url": "http://192.168.3.133:8888",  # 远程OCR服务器地址
    "timeout": 300,  # 请求超时时间（秒）
    "retry_times": 3,  # 重试次数
    "fallback_to_local": True  # 远程失败时是否回退到本地
}
```

### 服务器配置

- **端口**: 8888
- **主机**: 0.0.0.0 (允许外部访问)
- **超时**: 300秒
- **日志**: logs/remote_ocr_server.log

## 🔧 使用方式

### 正常使用流程

1. **启动远程OCR服务器** (在192.168.3.133上)
2. **启用远程OCR配置** (在本地电脑上)
3. **运行主程序** (在本地电脑上)
4. **扫描和解析文件** - OCR任务会自动发送到远程GPU服务器

### 回退机制

- 如果远程服务器不可用，系统会自动回退到本地OCR
- 如果远程处理失败，也会回退到本地OCR
- 可以通过配置 `fallback_to_local: False` 禁用回退

## 📊 性能对比

| 处理方式 | 处理速度 | 资源占用 | 网络依赖 |
|---------|---------|---------|---------|
| 本地CPU | 慢 | 高 | 无 |
| 远程GPU | 快 | 低 | 有 |
| 混合模式 | 快+稳定 | 中等 | 有 |

## 🛠️ 故障排除

### 常见问题

1. **连接超时**
   - 检查网络连接
   - 确认服务器地址和端口
   - 检查防火墙设置

2. **服务器启动失败**
   - 检查Python环境和依赖
   - 确认GPU驱动和CUDA
   - 查看服务器日志

3. **OCR处理失败**
   - 检查文件格式支持
   - 确认服务器资源充足
   - 查看错误日志

### 日志位置

- **服务器日志**: logs/remote_ocr_server.log
- **客户端日志**: 控制台输出
- **主程序日志**: 控制台输出

## 🔒 安全考虑

1. **网络安全**
   - 建议在内网环境使用
   - 可以配置防火墙规则
   - 考虑使用HTTPS

2. **文件安全**
   - 临时文件会自动清理
   - 敏感文件建议本地处理

## 📈 监控和维护

### 服务器监控

```bash
# 检查服务状态
curl http://192.168.3.133:8888/health

# 查看服务日志
tail -f logs/remote_ocr_server.log
```

### 性能优化

1. **服务器端**
   - 调整GPU内存使用
   - 优化批处理大小
   - 监控资源使用

2. **客户端**
   - 调整超时时间
   - 优化文件传输
   - 配置重试策略

## 🎯 最佳实践

1. **网络优化**
   - 使用有线网络连接
   - 确保网络带宽充足
   - 避免网络拥塞时段

2. **资源管理**
   - 定期清理临时文件
   - 监控服务器资源
   - 合理设置超时时间

3. **错误处理**
   - 启用回退机制
   - 记录详细日志
   - 定期检查服务状态

## 📞 技术支持

如果遇到问题，请检查：
1. 网络连接状态
2. 服务器运行状态
3. 配置文件设置
4. 日志错误信息

---

**注意**: 首次部署时建议先在测试环境验证，确保所有组件正常工作后再在生产环境使用。
